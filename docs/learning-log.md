# 学習メモ（ドライバーログブック）

エンジニア転職を見据え、プロジェクトの学びを言語化して武器にするための記録帳。

- 1 セッション 1 エントリを目安に、作業前の狙い・作業後の学び・次への疑問を残す
- コードの断片や参考リンクがあれば積極的に添える
- 迷った点や仮説もそのまま書き、後から振り返って理解の変化を確認する

---

## 2025-09-26 セッション

- **狙い**：microCMS テンプレから日報アプリ用の土台に作り変え、学習ロードマップを可視化する
- **実施内容**：
  - Supabase ベースのディレクトリ構成を用意し、認証・レポート CRUD ページをプレースホルダーで作成
  - UI コンポーネント群と Supabase クライアント、Zod バリデーションの下準備を実施
  - プレイブックと README を日本語化し、理解重視の進め方を整理
- **気づき**：
  - 目的が明確だと、不要なファイルの整理や命名の一貫性を保ちやすい
  - Supabase との統合前でも、認証や CRUD のフローを意識したプレースホルダーを用意しておくと実装の見通しが立つ
- **次に調べたいこと**：Supabase Auth でのセッション取得と、App Router での保護ルート設計パターン

---

※ 次回以降も、区切りの良いタイミングでこのファイルに追記していきます。

## 2025-09-27 セッション

- **目的**: 委託ドライバー向け日報アプリの MVP 設計と、Supabase 認証の実装。
- **完了条件**: ログイン・サインアップ機能が動作し、学んだ知見を時系列で記録する。

### 主な学びと解決した問題

1.  **Supabase サーバークライアントの型エラー**
    - **状況**: `src/lib/supabase/server.ts` で `createServerClient` を使用した際、`next/headers` の `cookies()` 関数を渡すと型エラーでビルドが失敗した。
    - **原因**: `@supabase/ssr` ライブラリが `cookies` オプションに `get`, `set`, `remove` メソッドを持つオブジェクトを期待しているのに対し、Next.js の `cookies()` は関数そのものを返すため、型の不一致が発生していた。
    - **解決策**: `cookies()` から返される `ReadonlyRequestCookies` をラップし、Supabase が要求するインターフェースに適合するオブジェクトを作成して渡すことで解決した。

2.  **Supabase 認証フローの実装**
    - **環境設定**: `.env.local` に正しい `NEXT_PUBLIC_SUPABASE_URL` と `NEXT_PUBLIC_SUPABASE_ANON_KEY` を設定し、401 認証エラーを解消。設定変更後は `npm run dev` での再起動が必要。
    - **サインアップ**: サインアップ画面に Supabase のアカウント作成処理を実装。`data.user` と `data.session` の違い（`user` はユーザー情報、`session` は認証状態）を理解した。
    - **サインイン**: メール認証後のサインインフローを検証。`loading` や `errorMessage` といった状態変数を用いた UI の状態管理方法を把握した。

3.  **開発オペレーション**
    - Next.js 開発サーバーの再起動は `Ctrl + C` で停止後、`npm run dev` で再実行する。
    - `rs` コマンドによる再起動ショートカットも確認した。

## 2025-10-02 セッション

- **目的**: Supabase クライアント周りを v2 推奨構成に移行し、サーバー側のセッション処理を理解する。
- **実施内容**:
  - `@supabase/ssr` を v2 系にアップデートし、`createServerClient` / `createBrowserClient` の新 API に書き換え。
  - `createSupabaseServerClient` で Cookie 操作をライブラリへ委譲する実装へ刷新し、`createSupabaseBrowserClient` も同様に更新。
  - `.env.local` のキー名とコード側の参照を `NEXT_PUBLIC_SUPABASE_ANON_KEY` に統一し、環境変数未設定エラーを解消。
  - サインイン／サインアップフローが v2 でも動作することをローカルで手動検証。
- **気づき**:
  - セッションは Supabase が Cookie 経由で保持する「ログイン中の自分の証明書」であり、サーバーからも Cookie を正しく読み書きできる設計が不可欠。
  - フレームワーク側の最新ヘルパーを利用すると、自前で `set` / `remove` を実装するより安全にセッションを扱える。
- **次に調べたいこと**: `/reports` で Supabase から日報一覧を取得する際の SSR/CSR 方針と、Zod バリデーションを繋いだフォーム送信フロー。
